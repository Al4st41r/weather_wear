<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Weather Wear</title>
<style>
  body {
    font-family: sans-serif;
    background: #fff;
    margin: 0;
    padding: 0;
    text-align: center;
    color: #222;
  }
  header {
    padding: 1rem;
    font-size: 1.5rem;
    font-weight: bold;
  }
  .controls {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 0 1rem;
  }
  input, button {
    padding: 0.6rem;
    font-size: 1rem;
    border: 1px solid #aaa;
    border-radius: 5px;
  }
  button {
    background: #f8f8f8;
    cursor: pointer;
  }
  button:hover {
    background: #eee;
  }
  .recommendation {
    margin-top: 1.5rem;
    padding: 1rem;
    border-top: 1px solid #ddd;
  }
  .item {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin: 0.3rem 0;
  }
  svg {
    width: 24px;
    height: 24px;
    stroke: #333;
    fill: none;
    stroke-width: 2;
  }
</style>
</head>
<body>
  <header>Weather Wear</header>
  <div class="controls">
    <input id="cityInput" type="text" placeholder="Enter city (e.g. Manchester)" />
    <button onclick="getWeatherByCity()">Check Weather</button>
    <button onclick="getWeatherByLocation()">Use My Location</button>
  </div>
  <div id="weather" class="recommendation"></div>

<script>
const WORKER_URL = "https://weather-proxy.alastairogle.workers.dev";

async function getWeatherData(query) {
  try {
    const res = await fetch(`${WORKER_URL}?q=${encodeURIComponent(query)}`);
    if (!res.ok) throw new Error("Weather data fetch failed");
    return await res.json();
  } catch (err) {
    console.error(err);
    document.getElementById("weather").innerHTML = "<p>Unable to fetch weather data.</p>";
  }
}

function suggestClothing(temp, wind, wet) {
  const items = [];

  if (temp < 0) {
    items.push({ icon: coatIcon(), text: "Heavy winter coat" });
    items.push({ icon: scarfIcon(), text: "Scarf & gloves" });
  } else if (temp < 10) {
    items.push({ icon: jacketIcon(), text: "Warm jacket" });
  } else if (temp < 18) {
    items.push({ icon: jumperIcon(), text: "Light jumper or cardigan" });
  } else {
    items.push({ icon: tshirtIcon(), text: "T-shirt" });
  }

  if (wind > 25 && temp < 15) {
    items.push({ icon: windIcon(), text: "Windproof layer" });
  }

  if (wet) {
    items.push({ icon: rainIcon(), text: "Waterproof layer" });
  }

  return items;
}

async function updateWeather(locationName, lat, lon) {
  let data;
  if (lat && lon) {
    data = await getWeatherData(`${lat},${lon}`);
  } else {
    data = await getWeatherData(locationName);
  }
  if (!data) return;

  const current = data.current;
  const forecast = data.forecast;

  const temp = current.temp;
  const wind = current.wind_speed;
  const wet = current.rain || current.snow || forecast.rain || forecast.snow;

  const recs = suggestClothing(temp, wind, wet);

  const html = `
    <h2>${data.location}</h2>
    <p>${current.description}, ${temp}Â°C</p>
    ${recs.map(r => `
      <div class="item">${r.icon}<span>${r.text}</span></div>
    `).join("")}
  `;
  document.getElementById("weather").innerHTML = html;
}

function getWeatherByCity() {
  const city = document.getElementById("cityInput").value.trim();
  if (city) {
    updateWeather(city);
  } else {
    updateWeather("London");
  }
}

function getWeatherByLocation() {
  if (!navigator.geolocation) {
    alert("Geolocation not supported");
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    updateWeather(null, pos.coords.latitude, pos.coords.longitude);
  }, err => {
    alert("Unable to retrieve location");
    updateWeather("London");
  });
}

// Icons
function coatIcon() {
  return `<svg viewBox="0 0 24 24"><path d="M6 3l-2 9v9h4v-6h8v6h4v-9l-2-9z"/></svg>`;
}
function jacketIcon() {
  return `<svg viewBox="0 0 24 24"><path d="M8 2v6h8V2h-2v4h-4V2z M6 8v14h4v-8h4v8h4V8z"/></svg>`;
}
function jumperIcon() {
  return `<svg viewBox="0 0 24 24"><path d="M6 3h12l2 6v12H4V9z"/></svg>`;
}
function tshirtIcon() {
  return `<svg viewBox="0 0 24 24"><path d="M4 4l4-2 4 2 4-2 4 2v4l-2 2v10H6V10L4 8z"/></svg>`;
}
function scarfIcon() {
  return `<svg viewBox="0 0 24 24"><path d="M10 2h4v8h-4zM8 10h2v12H8zM14 10h2v12h-2z"/></svg>`;
}
function windIcon() {
  return `<svg viewBox="0 0 24 24"><path d="M4 8h13a3 3 0 1 0-3-3M4 16h9a3 3 0 1 1-3 3"/></svg>`;
}
function rainIcon() {
  return `<svg viewBox="0 0 24 24"><path d="M4 14h16M8 17v4M12 17v4M16 17v4"/></svg>`;
}

// Init
updateWeather("London");
</script>
</body>
</html>

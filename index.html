<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather Wear</title>
<style>
  body {
    font-family: sans-serif;
    background: white;
    color: #333;
    text-align: center;
    padding: 20px;
  }
  h1 {
    margin-bottom: 0.5em;
  }
  .weather {
    margin-top: 1em;
    font-size: 1.2em;
  }
  .icons {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 1em;
  }
  .icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0.5em;
    font-size: 0.9em;
  }
  svg {
    width: 50px;
    height: 50px;
    stroke: #333;
    fill: none;
    stroke-width: 2;
  }
  input, button {
    padding: 0.5em;
    margin: 0.3em;
    font-size: 1em;
  }
</style>
</head>
<body>

<h1>Weather Wear</h1>
<p>What to wear to be comfortable based on your local weather.</p>

<div>
  <input type="text" id="cityInput" placeholder="Enter city (default London)">
  <button onclick="getWeatherByCity()">Check</button>
  <button onclick="getWeatherByLocation()">Use My Location</button>
</div>

<div class="weather" id="weather"></div>
<div class="icons" id="adviceIcons"></div>

<script>
const WORKER_URL = "https://weather-proxy.alastairogle.workers.dev";

function getClothingAdvice(temp, description, wind, humidity) {
  let advice = [];

  if (temp >= 20) {
    advice.push({ text: "T-shirt", icon: "tshirt" });
    advice.push({ text: "Shirt", icon: "shirt" });
  }
  else if (temp >= 15 && temp <= 19) {
    advice.push({ text: "T-shirt + Light Jacket", icon: "jacket" });
    advice.push({ text: "Long-sleeved Shirt", icon: "shirt" });
  }
  else if (temp >= 10 && temp <= 14) {
    advice.push({ text: "T-shirt + Shirt", icon: "shirt" });
    advice.push({ text: "Long-sleeved Shirt + Light Jacket", icon: "jacket" });
  }
  else if (temp >= 5 && temp <= 9) {
    advice.push({ text: "T-shirt + Shirt + Jacket", icon: "jacket" });
    advice.push({ text: "Warm Coat", icon: "coat" });
  }
  else if (temp >= 0 && temp <= 4) {
    advice.push({ text: "Warm Coat + Shirt + T-shirt", icon: "coat" });
    advice.push({ text: "Scarf", icon: "scarf" });
  }
  else if (temp < 0) {
    advice.push({ text: "Heavy Coat + Layers", icon: "coat" });
    advice.push({ text: "Scarf, Gloves, Hat", icon: "hat" });
  }

  // Weather conditions
  if (/rain|drizzle/i.test(description)) advice.push({ text: "Umbrella", icon: "umbrella" });
  if (/snow/i.test(description)) advice.push({ text: "Gloves & Hat", icon: "hat" });
  if (wind > 30) advice.push({ text: "Windbreaker", icon: "wind" });
  if (humidity > 80 && temp > 20) advice.push({ text: "Breathable Fabrics", icon: "breathable" });

  return advice;
}

function iconSVG(type) {
  switch(type) {
    case "coat": return `<svg><path d="M15 2 v46 M35 2 v46 M15 2 h20 v10 h-20z"/></svg>`;
    case "jacket": return `<svg><path d="M15 5 h20 v40 h-20z M15 15 h20"/></svg>`;
    case "sweater": return `<svg><path d="M10 10 h30 v30 h-30z"/></svg>`;
    case "tshirt": return `<svg><path d="M20.071,7.032C17.339,7.032 16.219,5.841 15.104,4.118C10.818,4.118 7.025,5.259 7.025,10.538C7.02,14.798 6.975,17.563 6.975,17.63L12.043,17.667L12.093,13.457L12.093,36.129L28.05,36.129L28.05,13.457L28.1,17.667L33.168,17.563C33.168,17.563 33.118,14.798 33.118,10.538C33.118,5.259 29.325,4.118 25.039,4.118C23.924,5.841 22.804,7.032 20.072,7.032"/>
</svg>`;
    case "shirt": return `<svg><path d="M13.82 4.103C9.55 4.103 7 5.24 7 10.5v20.5h5V13.409 36h8M26.13 4.103C30.4 4.103 32.95 5.24 32.95 10.5v20.5h-5V13.409 36h-8M13.75 4.09l1.758-1.68c.28.495 3.127 3.553 4.442 3.553l-1.113 2.98.004.002c-2.136 0-4.21-3.119-5.083-4.856m12.5 0-1.758-1.68c-.28.495-3.127 3.553-4.442 3.553l1.113 2.98-.004.002c2.136 0 4.21-3.119 5.083-4.856M20 7v28.514m6.945-19l-6.1-0" style="fill:none;fill-rule:nonzero;stroke:black;stroke-width:1px;"/></svg>`;
		case "scarf": return `<svg><path d="M20 5 v20 h5 v20 m-5-20 h-5 v20"/></svg>`;
    case "umbrella": return `<svg><path d="M5 20 q20 -20 40 0 M25 20 v20"/></svg>`;
    case "hat": return `<svg><path d="M10 25 h30 v5 h-30z M15 20 h20 v5 h-20z"/></svg>`;
    case "wind": return `<svg><path d="M5 15 h20 m5 0 h10 m-5 10 h20"/></svg>`;
    case "breathable": return `<svg><circle cx="15" cy="15" r="5"/><circle cx="35" cy="15" r="5"/></svg>`;
    default: return "";
  }
}

async function fetchWeather(city = "London") {
  try {
    const res = await fetch(`${WORKER_URL}?city=${encodeURIComponent(city)}`);
    const data = await res.json();
    
    if (!data.current || !data.current.main) {
      document.getElementById("weather").textContent = "Error: Could not fetch weather data.";
      return;
    }

    const temp = Math.round(data.current.main.temp);
    const description = data.current.weather[0].description;
    const wind = data.current.wind.speed;
    const humidity = data.current.main.humidity;

    document.getElementById("weather").textContent = 
      `${city}: ${description}, ${temp}°C`;

    const advice = getClothingAdvice(temp, description, wind, humidity);
    document.getElementById("adviceIcons").innerHTML = advice.map(a => `
      <div class="icon">
        ${iconSVG(a.icon)}
        <div>${a.text}</div>
      </div>
    `).join("");
  } catch (err) {
    document.getElementById("weather").textContent = "Error fetching weather.";
  }
}

function getWeatherByCity() {
  const city = document.getElementById("cityInput").value || "London";
  fetchWeather(city);
}

function getWeatherByLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(async (pos) => {
      const { latitude, longitude } = pos.coords;
      try {
        const res = await fetch(`${WORKER_URL}?lat=${latitude}&lon=${longitude}`);
        const data = await res.json();
        const city = data.current.name || "Your location";
        const temp = Math.round(data.current.main.temp);
        const description = data.current.weather[0].description;
        const wind = data.current.wind.speed;
        const humidity = data.current.main.humidity;

        document.getElementById("weather").textContent = 
          `${city}: ${description}, ${temp}°C`;

        const advice = getClothingAdvice(temp, description, wind, humidity);
        document.getElementById("adviceIcons").innerHTML = advice.map(a => `
          <div class="icon">
            ${iconSVG(a.icon)}
            <div>${a.text}</div>
          </div>
        `).join("");
      } catch {
        document.getElementById("weather").textContent = "Error fetching location weather.";
      }
    });
  }
}

// Load default on page open
fetchWeather("London");
</script>
</body>
</html>

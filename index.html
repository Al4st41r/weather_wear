<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather Wear</title>
<style>
  body {
    font-family: sans-serif;
    background: white;
    color: #333;
    text-align: center;
    padding: 20px;
  }
  h1 {
    margin-bottom: 0.5em;
  }
  .weather {
    margin-top: 1em;
    font-size: 1.2em;
  }
  .icons {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 1em;
  }
  .icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0.5em;
    font-size: 0.9em;
  }
  svg {
    width: 50px;
    height: 50px;
    stroke: #333;
    fill: none;
    stroke-width: 2;
  }
  input, button {
    padding: 0.5em;
    margin: 0.3em;
    font-size: 1em;
  }
</style>
</head>
<body>

<h1>Weather Wear</h1>
<p>What to wear to be comfortable based on your local weather.</p>

<div>
  <input type="text" id="cityInput" placeholder="Enter city (default London)">
  <button onclick="getWeatherByCity()">Check</button>
  <button onclick="getWeatherByLocation()">Use My Location</button>
</div>

<div class="weather" id="weather"></div>
<div class="icons" id="adviceIcons"></div>

<script>
const WORKER_URL = "https://weather-proxy.alastairogle.workers.dev";

function getClothingAdvice(temp, description, wind, humidity) {
  let advice = [];
  
  if (temp < 0) advice.push({text: "Heavy Coat", icon: "coat"});
  else if (temp < 10) advice.push({text: "Jacket", icon: "jacket"});
  else if (temp < 18) advice.push({text: "Light Sweater", icon: "sweater"});
  else advice.push({text: "T-shirt", icon: "tshirt"});
  
  if (/rain|drizzle/i.test(description)) advice.push({text: "Umbrella", icon: "umbrella"});
  if (/snow/i.test(description)) advice.push({text: "Gloves & Hat", icon: "hat"});
  if (wind > 30) advice.push({text: "Windbreaker", icon: "wind"});
  if (humidity > 80 && temp > 20) advice.push({text: "Breathable Fabrics", icon: "breathable"});
  
  return advice;
}

function iconSVG(type) {
  switch(type) {
    case "coat": return `<svg><path d="M15 2 v46 M35 2 v46 M15 2 h20 v10 h-20z"/></svg>`;
    case "jacket": return `<svg><path d="M15 5 h20 v40 h-20z M15 15 h20"/></svg>`;
    case "sweater": return `<svg><path d="M10 10 h30 v30 h-30z"/></svg>`;
    case "tshirt": return `<svg viewBox="0 0 24 24"><path d="M4 4l4-2 4 2 4-2 4 2v4l-2 1v10H6V9L4 8z"/></svg>`;
    
    case "umbrella": return `<svg><path d="M5 20 q20 -20 40 0 M25 20 v20"/></svg>`;
    case "hat": return `<svg><path d="M10 25 h30 v5 h-30z M15 20 h20 v5 h-20z"/></svg>`;
    case "wind": return `<svg><path d="M5 15 h20 m5 0 h10 m-5 10 h20"/></svg>`;
    case "breathable": return `<svg><circle cx="15" cy="15" r="5"/><circle cx="35" cy="15" r="5"/></svg>`;
    default: return "";
  }
}

async function fetchWeather(city = "London") {
  try {
    const res = await fetch(`${WORKER_URL}?city=${encodeURIComponent(city)}`);
    const data = await res.json();
    
    if (!data.current || !data.current.main) {
      document.getElementById("weather").textContent = "Error: Could not fetch weather data.";
      return;
    }

    const temp = Math.round(data.current.main.temp);
    const description = data.current.weather[0].description;
    const wind = data.current.wind.speed;
    const humidity = data.current.main.humidity;

    document.getElementById("weather").textContent = 
      `${city}: ${description}, ${temp}°C`;

    const advice = getClothingAdvice(temp, description, wind, humidity);
    document.getElementById("adviceIcons").innerHTML = advice.map(a => `
      <div class="icon">
        ${iconSVG(a.icon)}
        <div>${a.text}</div>
      </div>
    `).join("");
  } catch (err) {
    document.getElementById("weather").textContent = "Error fetching weather.";
  }
}

function getWeatherByCity() {
  const city = document.getElementById("cityInput").value || "London";
  fetchWeather(city);
}

function getWeatherByLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(async (pos) => {
      const { latitude, longitude } = pos.coords;
      try {
        const res = await fetch(`${WORKER_URL}?lat=${latitude}&lon=${longitude}`);
        const data = await res.json();
        const city = data.current.name || "Your location";
        const temp = Math.round(data.current.main.temp);
        const description = data.current.weather[0].description;
        const wind = data.current.wind.speed;
        const humidity = data.current.main.humidity;

        document.getElementById("weather").textContent = 
          `${city}: ${description}, ${temp}°C`;

        const advice = getClothingAdvice(temp, description, wind, humidity);
        document.getElementById("adviceIcons").innerHTML = advice.map(a => `
          <div class="icon">
            ${iconSVG(a.icon)}
            <div>${a.text}</div>
          </div>
        `).join("");
      } catch {
        document.getElementById("weather").textContent = "Error fetching location weather.";
      }
    });
  }
}

// Load default on page open
fetchWeather("London");
</script>
</body>
</html>
